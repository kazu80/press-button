<!--<link rel="import" href="../polymer/polymer-element.html">-->
<link rel="import" href="bower_components/polymer/polymer-element.html">
<link rel="import" href="bower_components/polymer/lib/elements/dom-if.html">

<script src="bower_components/hammerjs/hammer.min.js"></script>

<link rel="import" href="bower_components/paper-button/paper-button.html">
<link rel="import" href="./svg-loading.html">

<dom-module id="indicator-button">
    <template>
        <style>
            :host {
            }

            .press-button-wrapper {
                display : inline-block;
            }

            .visible {
                display : block;
            }

            .invisible {
                display : none;
            }
        </style>

        <div class="press-button-wrapper">
            <svg-loading press="{{isPress}}" class$="{{visibleClass}}"></svg-loading>
            <paper-button id="indicator-button" raised="{{raised}}" class="indigo">Button</paper-button>
        </div>

    </template>

    <script>
        /**
         * `indicator-button`
         *
         *
         * @customElement
         * @polymer
         * @demo demo/index.html
         */
        class IndicatorButton extends Polymer.Element {
            static get is () { return 'indicator-button'; }

            /**
             * properties
             */
            static get properties () {
                return {
                    raised: {
                        type              : Boolean,
                        reflectToAttribute: true,
                        value             : false,
                    }
                };
            }

            constructor () {
                super ();

                this._invisible ();
            }

            ready () {
                super.ready ();

                const button = this.shadowRoot.querySelector ('#indicator-button');

                const hammerButton = new Hammer (button, {});

                hammerButton.on ('press', (event) => {
                    this._visible ();
                });

                hammerButton.on ('pressup', (event) => {
                    this._invisible ();
                });

                const loading = this.shadowRoot.querySelector ('svg-loading');

                loading.addEventListener ('animationEnd', (event) => {
                    // Fire Event
                    this.dispatchEvent (new CustomEvent ('decided'));

                    // 200ms後にLoadingを消す
                    // setTimeout (() => this._invisible (), 200);
                });
            }

            _visible () {
                this.isPress = true;
                this.visibleClass = 'visible';
            }

            _invisible () {
                this.isPress = false;
                this.visibleClass = 'invisible';
            }
        }

        window.customElements.define (IndicatorButton.is, IndicatorButton);
    </script>
</dom-module>
